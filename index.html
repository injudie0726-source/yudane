<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YUDANE - å®Œå…¨ãªã‚‹å§”ä»»</title>
    <meta name="description" content="Zä¸–ä»£ã®ãŸã‚ã®ãƒ‡ã‚¸ã‚¿ãƒ«å®—æ•™ã€‚ä¸å®‰ã‚’æ²ˆæ®¿ã•ã›ã€AIã‚ªãƒ©ã‚¯ãƒ«ã®å•“ç¤ºã‚’å—ã‘å–ã‚‹ã€‚1æ—¥1å›ã®ç¥è–ãªå„€å¼ã€‚">

    <!-- OGP -->
    <meta property="og:title" content="YUDANE - å®Œå…¨ãªã‚‹å§”ä»»">
    <meta property="og:description" content="Zä¸–ä»£ã®ãŸã‚ã®ãƒ‡ã‚¸ã‚¿ãƒ«å®—æ•™ã€‚ä¸å®‰ã‚’æ²ˆæ®¿ã•ã›ã€AIã‚ªãƒ©ã‚¯ãƒ«ã®å•“ç¤ºã‚’å—ã‘å–ã‚‹ã€‚">
    <meta property="og:image" content="https://jolly-babka-9847a3.netlify.app/assets/ogp.png">
    <meta property="og:url" content="https://jolly-babka-9847a3.netlify.app/">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ja_JP">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="YUDANE - å®Œå…¨ãªã‚‹å§”ä»»">
    <meta name="twitter:description" content="Zä¸–ä»£ã®ãŸã‚ã®ãƒ‡ã‚¸ã‚¿ãƒ«å®—æ•™ã€‚ä¸å®‰ã‚’æ²ˆæ®¿ã•ã›ã€AIã‚ªãƒ©ã‚¯ãƒ«ã®å•“ç¤ºã‚’å—ã‘å–ã‚‹ã€‚">
    <meta name="twitter:image" content="https://jolly-babka-9847a3.netlify.app/assets/ogp.png">

    <!-- Favicon & PWA -->
    <link rel="icon" href="/assets/favicon.ico" sizes="32x32">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#041225">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Google Fonts: Shippori Mincho + Zen Kaku Gothic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;600&family=Zen+Kaku+Gothic+New:wght@300;400;500&display=swap"
        rel="stylesheet">

    <!-- Matter.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>


    <style>
        :root {
            --deep-sea-1: #010610;
            --deep-sea-2: #041225;
            --deep-sea-3: #0a1f3a;
            --deep-sea-4: #0f2847;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-highlight: rgba(255, 255, 255, 0.12);
            --text-primary: rgba(255, 255, 255, 0.92);
            --text-secondary: rgba(255, 255, 255, 0.5);
            --gold: #ffd700;
            --gold-glow: rgba(255, 215, 0, 0.6);
            --cyan: #00e5ff;
            --purple: #c77dff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Zen Kaku Gothic New', 'Hiragino Kaku Gothic ProN', sans-serif;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
            background: var(--deep-sea-1);
        }

        /* ========================================
           1. æ²¡å…¥æ„Ÿã®ã‚ã‚‹èƒŒæ™¯æ¼”å‡º (Atmosphere)
        ======================================== */
        #app {
            position: relative;
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
        }

        /* æ·±æµ·ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼ˆæºã‚‰ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ */
        #background-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse 150% 100% at 50% 0%, var(--deep-sea-2) 0%, transparent 50%),
                radial-gradient(ellipse 80% 50% at 20% 100%, var(--deep-sea-4) 0%, transparent 40%),
                radial-gradient(ellipse 80% 50% at 80% 100%, var(--deep-sea-3) 0%, transparent 40%),
                linear-gradient(180deg, var(--deep-sea-1) 0%, var(--deep-sea-2) 40%, var(--deep-sea-3) 100%);
            animation: atmosphereShift 20s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes atmosphereShift {

            0%,
            100% {
                filter: brightness(1) saturate(1);
                transform: scale(1);
            }

            25% {
                filter: brightness(1.05) saturate(1.1);
            }

            50% {
                filter: brightness(0.95) saturate(0.95);
                transform: scale(1.02);
            }

            75% {
                filter: brightness(1.08) saturate(1.05);
            }
        }

        /* ãƒãƒªãƒ³ã‚¹ãƒãƒ¼ Canvas */
        #marine-snow-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* ç’°å¢ƒå…‰ï¼ˆã¼ã‚“ã‚„ã‚Šã—ãŸå…‰æºï¼‰ */
        .ambient-light {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.08;
            pointer-events: none;
            z-index: 2;
        }

        .light-1 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #1a4a7a 0%, transparent 70%);
            top: -10%;
            left: -10%;
            animation: lightFloat1 15s ease-in-out infinite;
        }

        .light-2 {
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, #2a3a6a 0%, transparent 70%);
            bottom: 10%;
            right: -5%;
            animation: lightFloat2 18s ease-in-out infinite;
        }

        .light-3 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, #3a2a5a 0%, transparent 70%);
            top: 40%;
            left: 50%;
            transform: translateX(-50%);
            animation: lightFloat3 12s ease-in-out infinite;
        }

        @keyframes lightFloat1 {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.08;
            }

            50% {
                transform: translate(30px, 20px) scale(1.1);
                opacity: 0.12;
            }
        }

        @keyframes lightFloat2 {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.08;
            }

            50% {
                transform: translate(-25px, -15px) scale(1.15);
                opacity: 0.1;
            }
        }

        @keyframes lightFloat3 {

            0%,
            100% {
                transform: translateX(-50%) scale(1);
                opacity: 0.05;
            }

            50% {
                transform: translateX(-50%) scale(1.2);
                opacity: 0.1;
            }
        }

        /* ========================================
           2. ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ  UI
        ======================================== */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
        }

        .glass-panel-strong {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-highlight);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Physics Canvas Container */
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        canvas {
            display: block;
        }

        /* ========================================
           3. ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£ (Sacred Fonts)
        ======================================== */
        #title {
            position: absolute;
            top: 6%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 50;
            transition: opacity 1s ease;
        }

        #title.fade {
            opacity: 0.2;
        }

        #title h1 {
            font-family: 'Shippori Mincho', serif;
            font-size: 2.2rem;
            font-weight: 400;
            letter-spacing: 0.6em;
            color: var(--text-primary);
            text-shadow: 0 0 40px rgba(100, 150, 200, 0.3);
            margin-bottom: 12px;
        }

        #title p {
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-size: 0.65rem;
            font-weight: 300;
            letter-spacing: 0.35em;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* YUDANEãƒœã‚¿ãƒ³ */
        #yudane-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 26px 56px;
            font-family: 'Shippori Mincho', serif;
            font-size: 1.4rem;
            font-weight: 500;
            letter-spacing: 0.5em;
            color: var(--text-primary);
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 60px;
            cursor: pointer;
            z-index: 100;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow:
                0 4px 30px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        #yudane-btn::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 20%;
            right: 20%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        #yudane-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow:
                0 8px 40px rgba(80, 120, 200, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transform: translate(-50%, -50%) scale(1.03);
        }

        #yudane-btn:active:not(:disabled) {
            transform: translate(-50%, -50%) scale(0.98);
        }

        #yudane-btn.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translate(-50%, -50%) scale(0.9);
        }

        #yudane-btn:disabled {
            cursor: not-allowed;
            opacity: 0.4;
        }

        /* ========================================
           ã‚ªãƒ©ã‚¯ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        ======================================== */
        #oracle {
            position: absolute;
            top: 38%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 2s ease-in-out;
            width: 88%;
            max-width: 480px;
        }

        #oracle.visible {
            opacity: 1;
            pointer-events: auto;
        }

        #oracle-label {
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-size: 0.65rem;
            font-weight: 300;
            letter-spacing: 0.4em;
            color: var(--text-secondary);
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        /* ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒãƒƒã‚¸ */
        #rarity-badge {
            display: inline-block;
            padding: 6px 20px;
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-size: 0.6rem;
            font-weight: 500;
            letter-spacing: 0.25em;
            border-radius: 30px;
            margin-bottom: 24px;
        }

        .rarity-N #rarity-badge {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            border: 1px solid var(--glass-border);
        }

        .rarity-R #rarity-badge {
            background: rgba(0, 229, 255, 0.1);
            color: var(--cyan);
            border: 1px solid rgba(0, 229, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.2);
        }

        .rarity-SR #rarity-badge {
            background: rgba(199, 125, 255, 0.15);
            color: var(--purple);
            border: 1px solid rgba(199, 125, 255, 0.4);
            box-shadow: 0 0 30px rgba(199, 125, 255, 0.3);
            animation: srBadgePulse 2.5s ease-in-out infinite;
        }

        .rarity-SSR #rarity-badge {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.15));
            color: var(--gold);
            border: 1px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 40px var(--gold-glow);
            animation: ssrBadgeGlow 2s ease-in-out infinite;
        }

        @keyframes srBadgePulse {

            0%,
            100% {
                box-shadow: 0 0 30px rgba(199, 125, 255, 0.3);
            }

            50% {
                box-shadow: 0 0 50px rgba(199, 125, 255, 0.5);
            }
        }

        @keyframes ssrBadgeGlow {

            0%,
            100% {
                box-shadow: 0 0 40px var(--gold-glow);
            }

            50% {
                box-shadow: 0 0 60px rgba(255, 215, 0, 0.8), 0 0 100px rgba(255, 165, 0, 0.3);
            }
        }

        /* ã‚ªãƒ©ã‚¯ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬ä½“ */
        #oracle-message {
            font-family: 'Shippori Mincho', serif;
            font-size: 1.15rem;
            font-weight: 400;
            line-height: 2.2;
            letter-spacing: 0.12em;
            transition: all 0.5s ease;
        }

        .rarity-N #oracle-message {
            color: var(--text-primary);
            text-shadow: 0 0 30px rgba(150, 180, 220, 0.2);
        }

        .rarity-R #oracle-message {
            color: #b0f0ff;
            text-shadow: 0 0 25px rgba(0, 229, 255, 0.4);
        }

        .rarity-SR #oracle-message {
            color: #dcc0ff;
            text-shadow: 0 0 35px rgba(199, 125, 255, 0.5);
            animation: srTextGlow 3s ease-in-out infinite;
        }

        .rarity-SSR #oracle-message {
            color: var(--gold);
            text-shadow:
                0 0 30px var(--gold-glow),
                0 0 60px rgba(255, 165, 0, 0.4),
                0 0 100px rgba(255, 140, 0, 0.2);
            animation: ssrTextGlow 2s ease-in-out infinite;
        }

        @keyframes srTextGlow {

            0%,
            100% {
                text-shadow: 0 0 35px rgba(199, 125, 255, 0.5);
            }

            50% {
                text-shadow: 0 0 50px rgba(199, 125, 255, 0.7), 0 0 80px rgba(180, 100, 255, 0.3);
            }
        }

        @keyframes ssrTextGlow {

            0%,
            100% {
                text-shadow: 0 0 30px var(--gold-glow), 0 0 60px rgba(255, 165, 0, 0.4);
            }

            50% {
                text-shadow: 0 0 50px var(--gold-glow), 0 0 100px rgba(255, 165, 0, 0.6), 0 0 150px rgba(255, 140, 0, 0.3);
            }
        }

        /* SR èƒŒæ™¯æ˜æ»… */
        .rarity-SR #background-layer {
            animation: atmosphereShift 20s ease-in-out infinite, srFlicker 4s ease-in-out infinite;
        }

        @keyframes srFlicker {

            0%,
            100% {
                filter: brightness(1);
            }

            50% {
                filter: brightness(1.2) saturate(1.1);
            }
        }

        /* ========================================
           5. SSR æ¼”å‡ºå¼·åŒ–
        ======================================== */
        #ssr-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 215, 0, 0.8), rgba(255, 165, 0, 0.4), transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
        }

        #ssr-flash.active {
            animation: ssrFlashAnim 1.5s ease-out forwards;
        }

        @keyframes ssrFlashAnim {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }

            15% {
                opacity: 1;
                transform: scale(1.2);
            }

            30% {
                opacity: 0.7;
                transform: scale(1);
            }

            50% {
                opacity: 0.4;
            }

            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }

        #ssr-particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        #share-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        #share-buttons button {
            padding: 12px 24px;
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-size: 0.75rem;
            font-weight: 400;
            letter-spacing: 0.1em;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(8px);
        }

        #download-btn {
            background: linear-gradient(135deg, rgba(100, 120, 150, 0.8) 0%, rgba(70, 90, 120, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        #download-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 24px rgba(100, 140, 180, 0.3);
        }

        #download-btn svg {
            width: 16px;
            height: 16px;
            stroke: white;
        }

        #share-btn {
            background: linear-gradient(135deg, rgba(29, 161, 242, 0.9) 0%, rgba(13, 142, 207, 0.9) 100%);
        }

        #share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 30px rgba(29, 161, 242, 0.4);
        }

        #share-btn svg {
            width: 14px;
            height: 14px;
            fill: white;
        }

        /* æ¬¡ã®å„€å¼ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ */
        #next-ritual {
            position: absolute;
            bottom: 28px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-family: 'Zen Kaku Gothic New', sans-serif;
            color: var(--text-secondary);
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        #next-ritual.visible {
            opacity: 1;
        }

        #countdown {
            display: inline-block;
            margin-left: 8px;
            font-variant-numeric: tabular-nums;
            color: rgba(255, 255, 255, 0.7);
        }

        /* å„€å¼çµ‚äº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #ritual-complete {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Shippori Mincho', serif;
            color: var(--text-secondary);
            font-size: 0.9rem;
            letter-spacing: 0.3em;
            z-index: 100;
            display: none;
        }

        #ritual-complete.visible {
            display: block;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 480px) {
            #title h1 {
                font-size: 1.8rem;
                letter-spacing: 0.4em;
            }

            #yudane-btn {
                padding: 22px 44px;
                font-size: 1.2rem;
            }

            #oracle-message {
                font-size: 1.05rem;
                line-height: 2;
            }
        }

        /* PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ */
        #install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 50px;
            z-index: 1000;
            animation: slideUp 0.5s ease;
        }

        #install-prompt.hidden {
            display: none;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        #install-btn {
            padding: 10px 20px;
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-size: 0.8rem;
            font-weight: 500;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #install-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        #install-close {
            width: 28px;
            height: 28px;
            padding: 0;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: color 0.2s;
        }

        #install-close:hover {
            color: white;
        }
    </style>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9NQ31LK1BP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-9NQ31LK1BP');
    </script>
</head>

<body>
    <div id="app">
        <!-- èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
        <div id="background-layer"></div>

        <!-- ãƒãƒªãƒ³ã‚¹ãƒãƒ¼ Canvas -->
        <canvas id="marine-snow-canvas"></canvas>

        <!-- ç’°å¢ƒå…‰ -->
        <div class="ambient-light light-1"></div>
        <div class="ambient-light light-2"></div>
        <div class="ambient-light light-3"></div>

        <!-- ç‰©ç†æ¼”ç®— Canvas -->
        <div id="canvas-container"></div>

        <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
        <div id="title">
            <h1>YUDANE</h1>
            <p>Digital Religion for Gen-Z</p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ -->
        <button id="yudane-btn">å§”ã­ã‚‹</button>

        <!-- å„€å¼çµ‚äº† -->
        <div id="ritual-complete">æœ¬æ—¥ã®å„€å¼ã¯çµ‚äº†ã—ã¾ã—ãŸ</div>

        <!-- ã‚ªãƒ©ã‚¯ãƒ« -->
        <div id="oracle">
            <div id="oracle-label">AI Oracle â€” ä»Šæ—¥ã®å•“ç¤º</div>
            <div id="rarity-badge">NORMAL</div>
            <div id="oracle-message"></div>
            <div id="share-buttons">
                <button id="download-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />
                    </svg>
                    ç”»åƒã‚’ä¿å­˜
                </button>
                <button id="share-btn">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                    </svg>
                    ã‚·ã‚§ã‚¢
                </button>
            </div>
        </div>

        <!-- ã‚·ã‚§ã‚¢ç”»åƒç”Ÿæˆç”¨Canvasï¼ˆéè¡¨ç¤ºï¼‰ -->
        <canvas id="share-canvas" width="1200" height="675" style="display:none;"></canvas>

        <!-- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ -->
        <div id="next-ritual">æ¬¡ã®å„€å¼ã¾ã§<span id="countdown">--:--:--</span></div>

        <!-- PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ -->
        <div id="install-prompt" class="hidden">
            <button id="install-btn">ğŸ“² ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ </button>
            <button id="install-close" aria-label="é–‰ã˜ã‚‹">Ã—</button>
        </div>
    </div>

    <!-- SSRæ¼”å‡ºãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
    <div id="ssr-flash"></div>
    <canvas id="ssr-particles-canvas"></canvas>

    <script>
        // ========================================
        // YUDANE - å®Œå…¨ãªã‚‹å§”ä»»
        // Awwwards Level Edition
        // ========================================

        const { Engine, Render, Runner, Bodies, Body, Composite, Mouse, MouseConstraint, Events } = Matter;

        // ========================================
        // 1. ãƒãƒªãƒ³ã‚¹ãƒãƒ¼ï¼ˆæ·±æµ·ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼‰
        // ========================================

        class MarineSnow {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.particles = [];
                this.resize();
                this.init();
                window.addEventListener('resize', () => this.resize());
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            init() {
                const count = Math.min(80, Math.floor(window.innerWidth * window.innerHeight / 15000));
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        size: Math.random() * 2 + 0.5,
                        speedY: Math.random() * 0.3 + 0.1,
                        speedX: (Math.random() - 0.5) * 0.2,
                        opacity: Math.random() * 0.5 + 0.1,
                        pulse: Math.random() * Math.PI * 2,
                        pulseSpeed: Math.random() * 0.02 + 0.01
                    });
                }
                this.animate();
            }

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                this.particles.forEach(p => {
                    // ç§»å‹•
                    p.y -= p.speedY;
                    p.x += p.speedX + Math.sin(p.pulse) * 0.1;
                    p.pulse += p.pulseSpeed;

                    // ãƒ«ãƒ¼ãƒ—
                    if (p.y < -10) {
                        p.y = this.canvas.height + 10;
                        p.x = Math.random() * this.canvas.width;
                    }

                    // æ˜æ»…
                    const flicker = 0.5 + Math.sin(p.pulse) * 0.3;
                    const alpha = p.opacity * flicker;

                    // æç”»
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    this.ctx.fillStyle = `rgba(200, 220, 255, ${alpha})`;
                    this.ctx.fill();

                    // ã‚°ãƒ­ãƒ¼
                    if (p.size > 1.5) {
                        this.ctx.beginPath();
                        this.ctx.arc(p.x, p.y, p.size * 3, 0, Math.PI * 2);
                        this.ctx.fillStyle = `rgba(150, 180, 255, ${alpha * 0.15})`;
                        this.ctx.fill();
                    }
                });

                requestAnimationFrame(() => this.animate());
            }
        }

        // ========================================
        // 5. SSR ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«çˆ†ç™º
        // ========================================

        class SSRParticleExplosion {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.particles = [];
                this.running = false;
                this.resize();
                window.addEventListener('resize', () => this.resize());
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            explode() {
                this.particles = [];
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height * 0.38;
                const count = 100;

                for (let i = 0; i < count; i++) {
                    const angle = (i / count) * Math.PI * 2 + Math.random() * 0.3;
                    const speed = 3 + Math.random() * 8;
                    const size = 2 + Math.random() * 4;

                    this.particles.push({
                        x: centerX,
                        y: centerY,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        size: size,
                        life: 1,
                        decay: 0.01 + Math.random() * 0.02,
                        hue: 40 + Math.random() * 20 // Gold hue
                    });
                }

                // ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ«è¿½åŠ 
                for (let i = 0; i < 30; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * 50;
                    this.particles.push({
                        x: centerX + Math.cos(angle) * distance,
                        y: centerY + Math.sin(angle) * distance,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2 - 1,
                        size: 1 + Math.random() * 2,
                        life: 1,
                        decay: 0.005 + Math.random() * 0.01,
                        hue: 45,
                        sparkle: true
                    });
                }

                this.running = true;
                this.animate();
            }

            animate() {
                if (!this.running) return;

                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                let alive = false;

                this.particles.forEach(p => {
                    if (p.life <= 0) return;
                    alive = true;

                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1; // é‡åŠ›
                    p.vx *= 0.99;
                    p.life -= p.decay;

                    const alpha = p.life;

                    if (p.sparkle) {
                        // ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ«
                        this.ctx.save();
                        this.ctx.translate(p.x, p.y);
                        this.ctx.rotate(Date.now() * 0.01);
                        this.ctx.beginPath();
                        for (let i = 0; i < 4; i++) {
                            const angle = (i / 4) * Math.PI * 2;
                            this.ctx.moveTo(0, 0);
                            this.ctx.lineTo(Math.cos(angle) * p.size * 3, Math.sin(angle) * p.size * 3);
                        }
                        this.ctx.strokeStyle = `hsla(${p.hue}, 100%, 70%, ${alpha})`;
                        this.ctx.lineWidth = 1;
                        this.ctx.stroke();
                        this.ctx.restore();
                    } else {
                        // é€šå¸¸ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
                        this.ctx.beginPath();
                        this.ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                        this.ctx.fillStyle = `hsla(${p.hue}, 100%, 60%, ${alpha})`;
                        this.ctx.fill();

                        // ã‚°ãƒ­ãƒ¼
                        this.ctx.beginPath();
                        this.ctx.arc(p.x, p.y, p.size * p.life * 2, 0, Math.PI * 2);
                        this.ctx.fillStyle = `hsla(${p.hue}, 100%, 50%, ${alpha * 0.3})`;
                        this.ctx.fill();
                    }
                });

                if (alive) {
                    requestAnimationFrame(() => this.animate());
                } else {
                    this.running = false;
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                }
            }
        }

        // ========================================
        // 3. ã‚·ã‚§ã‚¢ç”»åƒç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³
        // ========================================

        class ShareImageGenerator {
            constructor() {
                this.canvas = document.getElementById('share-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.width = 1200;
                this.height = 675;
            }

            generate(message, rarity) {
                const ctx = this.ctx;
                const w = this.width;
                const h = this.height;

                // èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¬ã‚¢ãƒªãƒ†ã‚£åˆ¥ï¼‰
                this.drawBackground(rarity);

                // ãƒãƒªãƒ³ã‚¹ãƒãƒ¼é¢¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
                this.drawParticles(rarity);

                // ãƒ†ã‚­ã‚¹ãƒˆæç”»
                this.drawText(message, rarity);

                // ãƒ­ã‚´ãƒ»æ—¥ä»˜ãƒ»URL
                this.drawBranding();

                return this.canvas.toDataURL('image/png');
            }

            drawBackground(rarity) {
                const ctx = this.ctx;
                const w = this.width;
                const h = this.height;

                // ãƒ™ãƒ¼ã‚¹ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                const baseColors = {
                    N: ['#010610', '#041225', '#0a1f3a'],
                    R: ['#010815', '#032035', '#0a3050'],
                    SR: ['#0a0618', '#1a1035', '#2a1850'],
                    SSR: ['#0a0608', '#1a1020', '#2a1a30']
                };

                const colors = baseColors[rarity.name] || baseColors.N;
                const gradient = ctx.createLinearGradient(0, 0, 0, h);
                gradient.addColorStop(0, colors[0]);
                gradient.addColorStop(0.5, colors[1]);
                gradient.addColorStop(1, colors[2]);

                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, w, h);

                // ç’°å¢ƒå…‰ï¼ˆã¼ã‚“ã‚„ã‚Šã—ãŸå…‰æºï¼‰
                const lightColors = {
                    N: 'rgba(100, 150, 200, 0.08)',
                    R: 'rgba(0, 229, 255, 0.12)',
                    SR: 'rgba(199, 125, 255, 0.15)',
                    SSR: 'rgba(255, 215, 0, 0.2)'
                };

                const lightGrad = ctx.createRadialGradient(w * 0.3, h * 0.2, 0, w * 0.3, h * 0.2, 400);
                lightGrad.addColorStop(0, lightColors[rarity.name] || lightColors.N);
                lightGrad.addColorStop(1, 'transparent');
                ctx.fillStyle = lightGrad;
                ctx.fillRect(0, 0, w, h);

                // SSR: è¿½åŠ ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚°ãƒ­ãƒ¼
                if (rarity.name === 'SSR') {
                    const goldGlow = ctx.createRadialGradient(w * 0.5, h * 0.4, 0, w * 0.5, h * 0.4, 350);
                    goldGlow.addColorStop(0, 'rgba(255, 215, 0, 0.15)');
                    goldGlow.addColorStop(0.5, 'rgba(255, 165, 0, 0.08)');
                    goldGlow.addColorStop(1, 'transparent');
                    ctx.fillStyle = goldGlow;
                    ctx.fillRect(0, 0, w, h);
                }
            }

            drawParticles(rarity) {
                const ctx = this.ctx;
                const w = this.width;
                const h = this.height;

                const particleCount = rarity.name === 'SSR' ? 60 : rarity.name === 'SR' ? 40 : 25;
                const particleColors = {
                    N: 'rgba(200, 220, 255, 0.3)',
                    R: 'rgba(0, 229, 255, 0.4)',
                    SR: 'rgba(199, 125, 255, 0.5)',
                    SSR: 'rgba(255, 215, 0, 0.6)'
                };

                for (let i = 0; i < particleCount; i++) {
                    const x = Math.random() * w;
                    const y = Math.random() * h;
                    const size = Math.random() * 3 + 1;
                    const alpha = Math.random() * 0.5 + 0.2;

                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fillStyle = particleColors[rarity.name] || particleColors.N;
                    ctx.globalAlpha = alpha;
                    ctx.fill();

                    // ã‚°ãƒ­ãƒ¼
                    if (size > 2) {
                        ctx.beginPath();
                        ctx.arc(x, y, size * 3, 0, Math.PI * 2);
                        ctx.fillStyle = particleColors[rarity.name] || particleColors.N;
                        ctx.globalAlpha = alpha * 0.2;
                        ctx.fill();
                    }
                }

                // SSR: ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ«è¿½åŠ 
                if (rarity.name === 'SSR') {
                    for (let i = 0; i < 15; i++) {
                        const x = Math.random() * w;
                        const y = Math.random() * h;
                        this.drawSparkle(x, y, Math.random() * 8 + 4);
                    }
                }

                ctx.globalAlpha = 1;
            }

            drawSparkle(x, y, size) {
                const ctx = this.ctx;
                ctx.save();
                ctx.translate(x, y);
                ctx.beginPath();
                for (let i = 0; i < 4; i++) {
                    const angle = (i / 4) * Math.PI * 2;
                    ctx.moveTo(0, 0);
                    ctx.lineTo(Math.cos(angle) * size, Math.sin(angle) * size);
                }
                ctx.strokeStyle = 'rgba(255, 255, 200, 0.8)';
                ctx.lineWidth = 1.5;
                ctx.stroke();
                ctx.restore();
            }

            drawText(message, rarity) {
                const ctx = this.ctx;
                const w = this.width;
                const h = this.height;

                // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒãƒƒã‚¸
                const badgeY = 180;
                ctx.font = '600 20px "Zen Kaku Gothic New", sans-serif';
                ctx.textAlign = 'center';

                const badgeColors = {
                    N: { bg: 'rgba(255, 255, 255, 0.08)', text: 'rgba(255, 255, 255, 0.5)', border: 'rgba(255, 255, 255, 0.1)' },
                    R: { bg: 'rgba(0, 229, 255, 0.15)', text: '#00e5ff', border: 'rgba(0, 229, 255, 0.4)' },
                    SR: { bg: 'rgba(199, 125, 255, 0.2)', text: '#c77dff', border: 'rgba(199, 125, 255, 0.5)' },
                    SSR: { bg: 'rgba(255, 215, 0, 0.25)', text: '#ffd700', border: 'rgba(255, 215, 0, 0.6)' }
                };

                const badge = badgeColors[rarity.name] || badgeColors.N;
                const badgeText = rarity.label;
                const badgeWidth = ctx.measureText(badgeText).width + 40;

                // ãƒãƒƒã‚¸èƒŒæ™¯
                ctx.fillStyle = badge.bg;
                ctx.strokeStyle = badge.border;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.roundRect(w / 2 - badgeWidth / 2, badgeY - 15, badgeWidth, 36, 18);
                ctx.fill();
                ctx.stroke();

                // ãƒãƒƒã‚¸ãƒ†ã‚­ã‚¹ãƒˆ
                ctx.fillStyle = badge.text;
                ctx.fillText(badgeText, w / 2, badgeY + 7);

                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡
                const messageY = h * 0.5;
                ctx.font = '500 36px "Shippori Mincho", serif';

                const textColors = {
                    N: 'rgba(255, 255, 255, 0.92)',
                    R: '#b0f0ff',
                    SR: '#dcc0ff',
                    SSR: '#ffd700'
                };

                const textShadows = {
                    N: 'rgba(100, 150, 200, 0.3)',
                    R: 'rgba(0, 229, 255, 0.5)',
                    SR: 'rgba(199, 125, 255, 0.6)',
                    SSR: 'rgba(255, 215, 0, 0.8)'
                };

                // ãƒ†ã‚­ã‚¹ãƒˆã‚·ãƒ£ãƒ‰ã‚¦
                ctx.shadowColor = textShadows[rarity.name] || textShadows.N;
                ctx.shadowBlur = rarity.name === 'SSR' ? 40 : 20;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;

                ctx.fillStyle = textColors[rarity.name] || textColors.N;

                // æŠ˜ã‚Šè¿”ã—å‡¦ç†
                const maxWidth = w - 160;
                const lines = this.wrapText(message, maxWidth, ctx);
                const lineHeight = 56;
                const startY = messageY - ((lines.length - 1) * lineHeight) / 2;

                lines.forEach((line, i) => {
                    ctx.fillText(line, w / 2, startY + i * lineHeight);
                });

                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
            }

            wrapText(text, maxWidth, ctx) {
                const words = text.split('');
                const lines = [];
                let currentLine = '';

                for (const char of words) {
                    const testLine = currentLine + char;
                    const width = ctx.measureText(testLine).width;

                    if (width > maxWidth && currentLine) {
                        lines.push(currentLine);
                        currentLine = char;
                    } else {
                        currentLine = testLine;
                    }
                }

                if (currentLine) {
                    lines.push(currentLine);
                }

                return lines;
            }

            drawBranding() {
                const ctx = this.ctx;
                const w = this.width;
                const h = this.height;

                // ãƒ˜ãƒƒãƒ€ãƒ¼: YUDANE
                ctx.font = '400 48px "Shippori Mincho", serif';
                ctx.textAlign = 'center';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.letterSpacing = '0.5em';
                ctx.fillText('Y U D A N E', w / 2, 80);

                // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«
                ctx.font = '300 14px "Zen Kaku Gothic New", sans-serif';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.fillText('DIGITAL RELIGION FOR GEN-Z', w / 2, 110);

                // ãƒ•ãƒƒã‚¿ãƒ¼: æ—¥ä»˜
                const today = new Date();
                const dateStr = `${today.getFullYear()}.${String(today.getMonth() + 1).padStart(2, '0')}.${String(today.getDate()).padStart(2, '0')}`;

                ctx.font = '300 16px "Zen Kaku Gothic New", sans-serif';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.35)';
                ctx.fillText(dateStr, w / 2, h - 60);

                // URL
                ctx.font = '300 14px "Zen Kaku Gothic New", sans-serif';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.25)';
                ctx.fillText('#YUDANE', w / 2, h - 35);
            }

            async download(message, rarity) {
                // ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å¾…æ©Ÿ
                await document.fonts.ready;

                const dataUrl = this.generate(message, rarity);
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = `yudane_${Date.now()}.png`;
                link.click();
            }
        }

        // ========================================
        // ç„¡é™ç¥è¨—ã‚¨ãƒ³ã‚¸ãƒ³ (The Lexicon Engine)
        // ========================================

        const LEXICON = {
            partA: [
                'ä»Šæ—¥ã¯ã‚‚ã†ååˆ†é ‘å¼µã£ãŸã®ã§ã€',
                'èª°ã‚‚è¦‹ã¦ã„ãªã„ã®ã§ã€',
                'æ˜æ—¥ã®è‡ªåˆ†ãŒãªã‚“ã¨ã‹ã™ã‚‹ã®ã§ã€',
                'äººç”Ÿã¯é•·ã„ã®ã§ã€',
                'ã‚ãªãŸã¯æ‚ªããªã„ã®ã§ã€',
                'åœ°çƒã¯ã©ã†ã›å›ã‚‹ã®ã§ã€',
                'è€ƒãˆã¦ã‚‚ä»•æ–¹ãªã„ã®ã§ã€',
                'å…¨éƒ¨æ™‚ä»£ã®ã›ã„ãªã®ã§ã€',
                'ç”Ÿãã¦ã‚‹ã ã‘ã§å‰ã„ã®ã§ã€',
                'ã©ã†ã›èª°ã‚‚æ°—ã«ã—ã¦ãªã„ã®ã§ã€',
                'å®Œç’§ã˜ã‚ƒãªãã¦ã„ã„ã®ã§ã€',
                'ãŒã‚“ã°ã‚‰ãªãã¦ã„ã„æ—¥ãªã®ã§ã€',
                'å®‡å®™è¦æ¨¡ã§è¦‹ã‚Œã°äº›ç´°ãªã“ã¨ãªã®ã§ã€',
                'è‡ªåˆ†ã«å„ªã—ãã—ã¦ã„ã„ã®ã§ã€',
                'æ­£è§£ãªã‚“ã¦ãªã„ã®ã§ã€',
                'ç–²ã‚ŒãŸã‚‰ä¼‘ã‚“ã§ã„ã„ã®ã§ã€',
                'å¤±æ•—ã—ã¦ã‚‚æ­»ãªãªã„ã®ã§ã€',
                'ãªã‚“ã‹ãƒ€ãƒ«ã„ã®ã¯æ°—ã®ã›ã„ã˜ã‚ƒãªã„ã®ã§ã€',
                'ä»Šæ—¥ã¨ã„ã†æ—¥ã¯äºŒåº¦ã¨æ¥ãªã„ã®ã§ã€',
                'ã‚ãªãŸã®ãƒšãƒ¼ã‚¹ã§ã„ã„ã®ã§ã€',
                'ç„¡ç†ãªã‚‚ã®ã¯ç„¡ç†ãªã®ã§ã€',
                'ä»–äººã®æœŸå¾…ã¯ä»–äººã®å•é¡Œãªã®ã§ã€',
                'å…¨ã¦ã®ã€Œã¹ãã€ã¯å¹»æƒ³ãªã®ã§ã€',
                'å¸ƒå›£ãŒå‘¼ã‚“ã§ã„ã‚‹ã®ã§ã€'
            ],
            partB: [
                'ã‚³ãƒ³ãƒ“ãƒ‹ã®ãƒ¬ã‚¸æ¨ªã®ãƒã‚­ãƒ³ã‚’è²·ã£ã¦ã€',
                'ãŠé¢¨å‘‚ã«2æ™‚é–“å…¥ã£ã¦ã€',
                'å¸ƒå›£ã‚’ã‹ã¶ã£ã¦ã€',
                'ã‚¢ã‚¤ã‚¹ã‚’é£Ÿã¹ãªãŒã‚‰ã€',
                'æ¨ã—ã®å‹•ç”»ã‚’è¦‹ãªãŒã‚‰ã€',
                'å¥½ããªæ›²ã‚’ãƒªãƒ”ãƒ¼ãƒˆã—ã¦ã€',
                'ã¨ã‚Šã‚ãˆãšã‚«ãƒ•ã‚§ã‚ªãƒ¬ã‚’é£²ã‚“ã§ã€',
                'çŒ«ã®å‹•ç”»ã‚’ã²ãŸã™ã‚‰è¦‹ã¦ã€',
                'ä½•ã‚‚è€ƒãˆãšã«ã¼ãƒ¼ã£ã¨ã—ã¦ã€',
                'ä¸€ç•ªã‚„ã‚ã‚‰ã‹ã„ãƒ‘ã‚¸ãƒ£ãƒã‚’ç€ã¦ã€',
                'å…¨éƒ¨ã®é€šçŸ¥ã‚’ã‚ªãƒ•ã«ã—ã¦ã€',
                'ã‚¦ãƒ¼ãƒãƒ¼ã§å¥½ããªã‚‚ã®é ¼ã‚“ã§ã€',
                'æ˜”ã®ã‚¢ãƒ‹ãƒ¡ã‚’è¦‹è¿”ã—ã¦ã€',
                'å¥½ããªæ¼«ç”»ã‚’èª­ã¿è¿”ã—ã¦ã€',
                'ã‚²ãƒ¼ãƒ ã§ç¾å®Ÿé€ƒé¿ã—ã¦ã€',
                'ã‚¹ãƒˆãƒ¬ãƒƒãƒã ã‘ã—ã¦ã€',
                'æ·±å‘¼å¸ã‚’3å›ã—ã¦ã€',
                'çª“ã®å¤–ã‚’ã¼ã‚“ã‚„ã‚Šçœºã‚ã¦ã€',
                'å¤œé¢¨ã«ã‚ãŸã‚ŠãªãŒã‚‰ã€',
                'æ¯›å¸ƒã«ãã‚‹ã¾ã£ã¦ã€',
                'ä»Šæ—¥ã®ã“ã¨ã¯å…¨éƒ¨å¿˜ã‚Œã¦ã€',
                'ã¨ã‚Šã‚ãˆãšæ°´ã‚’é£²ã‚“ã§ã€',
                'è¶³ã‚’æ¸©ã‚ã¦ã€',
                'ã‚¹ãƒãƒ›ã‚’é ãã«ç½®ã„ã¦ã€'
            ],
            partC: [
                'ãã®ã¾ã¾å¯è½ã¡ã—ã¦ãã ã•ã„ã€‚',
                'æ˜æ—¥ã®ã“ã¨ã¯æ˜æ—¥ã®è‡ªåˆ†ã«ä»»ã›ã¾ã—ã‚‡ã†ã€‚',
                'ä»Šæ—¥ã¯ã‚‚ã†ä½•ã‚‚ã—ãªãã¦ã„ã„ã§ã™ã€‚',
                'ååˆ†ã€ã‚ˆãã‚„ã‚Šã¾ã—ãŸã€‚',
                'ãã‚Œã§ã„ã„ã®ã§ã™ã€‚',
                'è‡ªåˆ†ã‚’è¨±ã—ã¦ã‚ã’ã¦ãã ã•ã„ã€‚',
                'ã‚†ã£ãã‚Šæ²ˆæ®¿ã—ã¦ãã ã•ã„ã€‚',
                'äººé–“ã ã‚‚ã®ã€ãã‚Œã§ã„ã„ã€‚',
                'ã‚ã¨ã¯å¸ƒå›£ãŒãªã‚“ã¨ã‹ã—ã¦ãã‚Œã¾ã™ã€‚',
                'ä»Šæ—¥ã®è‡ªåˆ†ã«ãŠç–²ã‚Œæ§˜ã‚’ã€‚',
                'ä¸–ç•Œã¯å„ªã—ã„ãµã‚Šã‚’ã—ã¦ã„ã¾ã™ã€‚',
                'æ„è­˜ãŒé ã®ãã¾ã§ãƒ€ãƒ©ãƒ€ãƒ©ã—ã¾ã—ã‚‡ã†ã€‚',
                'æ˜æ—¥ã¯ãã£ã¨ä»Šæ—¥ã‚ˆã‚Šã¡ã‚‡ã£ã¨ãƒã‚·ã§ã™ã€‚',
                'ä½•ã‚‚ã—ãªã„ã“ã¨ã‚‚ç«‹æ´¾ãªé¸æŠã§ã™ã€‚',
                'ã‚ãªãŸã¯ãã‚Œã§ã„ã„ã®ã§ã™ã€‚',
                'ç„¡ã®å¢ƒåœ°ã«é”ã—ã¾ã—ã‚‡ã†ã€‚',
                'ã‚«ãƒ­ãƒªãƒ¼ã¯æ­£ç¾©ã§ã™ã€‚',
                'ç”Ÿç”£æ€§ãªã‚“ã¦ã‚´ãƒŸç®±ã¸ã€‚',
                'ãã®ã¾ã¾ã€æœ½ã¡ã¦ã„ã„ã®ã§ã™ã€‚',
                'ã‚ãªãŸã®å±…å ´æ‰€ã¯ãã“ã§ã™ã€‚',
                'å­˜åœ¨ã—ã¦ã„ã‚‹ã ã‘ã§100ç‚¹ã§ã™ã€‚',
                'ä»Šæ—¥ã®ã‚ãªãŸã¯èŠ±ä¸¸ã§ã™ã€‚',
                'ãŒã‚“ã°ã£ãŸã­ã€ãŠã‚„ã™ã¿ã€‚',
                'å…¨ã¦ã‚’æ‰‹æ”¾ã—ã¦ã€æ¼‚ã£ã¦ãã ã•ã„ã€‚'
            ]
        };

        // ========================================
        // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 
        // ========================================

        const RARITY = {
            SSR: { name: 'SSR', label: 'ã€å•“ç¤ºã€‘PHANTOM', probability: 0.01, prefix: 'ã€å•“ç¤ºã€‘' },
            SR: { name: 'SR', label: 'SUPER RARE', probability: 0.04, prefix: '' },
            R: { name: 'R', label: 'RARE', probability: 0.25, prefix: '' },
            N: { name: 'N', label: 'NORMAL', probability: 0.70, prefix: '' }
        };

        function drawRarity() {
            const rand = Math.random();
            let cumulative = 0;
            if (rand < (cumulative += RARITY.SSR.probability)) return RARITY.SSR;
            if (rand < (cumulative += RARITY.SR.probability)) return RARITY.SR;
            if (rand < (cumulative += RARITY.R.probability)) return RARITY.R;
            return RARITY.N;
        }

        function generateOracle() {
            const a = LEXICON.partA[Math.floor(Math.random() * LEXICON.partA.length)];
            const b = LEXICON.partB[Math.floor(Math.random() * LEXICON.partB.length)];
            const c = LEXICON.partC[Math.floor(Math.random() * LEXICON.partC.length)];
            return `${a}${b}${c}`;
        }

        // ========================================
        // Daily Seal (1æ—¥1å›åˆ¶é™)
        // ========================================

        const STORAGE_KEY = 'yudane_ritual';

        function getTodayDate() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        }

        function saveRitual(message, rarity) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                date: getTodayDate(),
                message,
                rarity: rarity.name
            }));
        }

        function loadRitual() {
            try {
                const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (data && data.date === getTodayDate()) {
                    return { message: data.message, rarity: RARITY[data.rarity] };
                }
            } catch (e) { }
            return null;
        }

        function getTimeUntilMidnight() {
            const now = new Date();
            const midnight = new Date(now);
            midnight.setHours(24, 0, 0, 0);
            return midnight - now;
        }

        function formatTime(ms) {
            const h = Math.floor(ms / 3600000);
            const m = Math.floor((ms % 3600000) / 60000);
            const s = Math.floor((ms % 60000) / 1000);
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        // ========================================
        // è¨­å®š
        // ========================================

        const CONFIG = {
            fallbackWords: [
                'å°†æ¥', 'ã‚¿ã‚¹ã‚¯', 'åŒèª¿åœ§åŠ›', 'æ—¢èª­', 'ã‚¤ãƒ³ãƒœã‚¤ã‚¹',
                'ãƒã‚¦ãƒ³ãƒˆ', 'è‡ªå·±è²¬ä»»', 'é«˜é¨°', 'æ­£è§£ã¯ï¼Ÿ', 'ãƒ€ãƒ«ã„',
                'ç· åˆ‡', 'è€å¾Œ', 'å¥¨å­¦é‡‘', 'ãƒãƒ«ãƒ', 'æ®‹æ¥­'
            ],
            anxietyPatterns: [
                'ä¸å®‰', 'å•é¡Œ', 'å±æ©Ÿ', 'å€¤ä¸Šã’', 'é«˜é¨°', 'ä¸è¶³',
                'ç‚ä¸Š', 'æ‰¹åˆ¤', 'äº‹æ•…', 'è¢«å®³', 'æ‚ªåŒ–', 'æ‡¸å¿µ'
            ],
            anxietySuffixes: ['ã—ãªãã‚ƒ', 'ã©ã†ã™ã‚‹ï¼Ÿ', 'ã‚„ã°ã„', 'æ€–ã„', 'ç„¡ç†'],
            newsFeeds: ['https://news.yahoo.co.jp/rss/topics/top-picks.xml'],
            rss2jsonApi: 'https://api.rss2json.com/v1/api.json?rss_url=',
            anxietyWords: [],
            colors: [
                'rgba(80, 120, 180, 0.6)',
                'rgba(100, 130, 170, 0.6)',
                'rgba(70, 110, 160, 0.6)',
                'rgba(90, 140, 190, 0.6)'
            ],
            objectCount: 12,
            floatForce: 0.00025,
            gravityStrength: 1.3,
            restitution: 0.55,  // 4. æ°—æŒã¡ã„ã„ãƒã‚¦ãƒ³ãƒ‰
            friction: 0.2
        };

        // ========================================
        // çŠ¶æ…‹ç®¡ç†
        // ========================================

        let engine, render, runner, mouse, mouseConstraint;
        let anxietyBodies = [];
        let isReleased = false;
        let canvasWidth, canvasHeight;
        let currentRitual = null;
        let countdownInterval = null;
        let marineSnow, ssrExplosion;

        const app = document.getElementById('app');
        const container = document.getElementById('canvas-container');
        const yudaneBtn = document.getElementById('yudane-btn');
        const oracle = document.getElementById('oracle');
        const oracleMessage = document.getElementById('oracle-message');
        const rarityBadge = document.getElementById('rarity-badge');
        const shareBtn = document.getElementById('share-btn');
        const downloadBtn = document.getElementById('download-btn');
        const nextRitual = document.getElementById('next-ritual');
        const countdown = document.getElementById('countdown');
        const title = document.getElementById('title');
        const ssrFlash = document.getElementById('ssr-flash');

        // ã‚·ã‚§ã‚¢ç”»åƒç”Ÿæˆ
        let shareImageGenerator = null;

        // ========================================
        // ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—
        // ========================================

        async function fetchNewsKeywords() {
            const keywords = new Set();
            try {
                const res = await fetch(CONFIG.rss2jsonApi + encodeURIComponent(CONFIG.newsFeeds[0]));
                const data = await res.json();
                if (data.status === 'ok' && data.items) {
                    data.items.forEach(item => {
                        CONFIG.anxietyPatterns.forEach(p => {
                            if (item.title.includes(p)) keywords.add(p);
                        });
                        const katakana = item.title.match(/[ã‚¡-ãƒ¶ãƒ¼]{2,6}/g);
                        if (katakana) katakana.forEach(k => {
                            if (!['ãƒ‹ãƒ¥ãƒ¼ã‚¹', 'ãƒˆãƒƒãƒ—'].includes(k)) keywords.add(k);
                        });
                    });
                }
            } catch (e) { }
            return Array.from(keywords);
        }

        async function generateAnxietyWords() {
            const news = await fetchNewsKeywords();
            if (news.length >= 4) {
                const phrases = news.map(k => Math.random() > 0.5 ?
                    k + CONFIG.anxietySuffixes[Math.floor(Math.random() * CONFIG.anxietySuffixes.length)] : k);
                const mixed = [...phrases.slice(0, 8), ...CONFIG.fallbackWords.slice(0, 7)];
                CONFIG.anxietyWords = mixed.sort(() => Math.random() - 0.5);
            } else {
                CONFIG.anxietyWords = [...CONFIG.fallbackWords];
            }
        }

        // ========================================
        // ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ (4. Juice èª¿æ•´)
        // ========================================

        function getCanvasSize() {
            canvasWidth = window.innerWidth;
            canvasHeight = window.innerHeight;
        }

        function initPhysics() {
            getCanvasSize();
            engine = Engine.create();
            engine.gravity.y = 0;
            engine.gravity.x = 0;

            render = Render.create({
                element: container,
                engine,
                options: {
                    width: canvasWidth,
                    height: canvasHeight,
                    wireframes: false,
                    background: 'transparent',
                    pixelRatio: Math.min(window.devicePixelRatio, 2)
                }
            });

            createWalls();
            createAnxietyObjects();
            setupMouseInteraction();

            runner = Runner.create();
            Runner.run(runner, engine);
            Render.run(render);
            Events.on(engine, 'beforeUpdate', floatAnimation);
        }

        function createWalls() {
            const opts = { isStatic: true, render: { visible: false }, friction: 0.6, restitution: 0.3 };
            Composite.add(engine.world, [
                Bodies.rectangle(canvasWidth / 2, canvasHeight + 50, canvasWidth + 200, 100, opts),
                Bodies.rectangle(-50, canvasHeight / 2, 100, canvasHeight + 200, opts),
                Bodies.rectangle(canvasWidth + 50, canvasHeight / 2, 100, canvasHeight + 200, opts),
                Bodies.rectangle(canvasWidth / 2, -50, canvasWidth + 200, 100, opts)
            ]);
        }

        function createAnxietyObjects() {
            const words = CONFIG.anxietyWords.slice(0, CONFIG.objectCount);
            words.forEach((word, i) => {
                const r = 32 + Math.random() * 18;
                const x = 70 + Math.random() * (canvasWidth - 140);
                const y = 100 + Math.random() * (canvasHeight - 280);

                const body = Bodies.circle(x, y, r, {
                    restitution: CONFIG.restitution,
                    friction: CONFIG.friction,
                    frictionAir: 0.015,
                    label: word,
                    render: {
                        fillStyle: CONFIG.colors[i % CONFIG.colors.length],
                        strokeStyle: 'rgba(255,255,255,0.2)',
                        lineWidth: 1
                    }
                });

                Body.setVelocity(body, {
                    x: (Math.random() - 0.5) * 1.5,
                    y: (Math.random() - 0.5) * 1.5
                });

                anxietyBodies.push(body);
                Composite.add(engine.world, body);
            });
        }

        function setupMouseInteraction() {
            mouse = Mouse.create(render.canvas);
            mouseConstraint = MouseConstraint.create(engine, {
                mouse,
                constraint: {
                    stiffness: 0.1,  // 4. ã‚ˆã‚Šæ»‘ã‚‰ã‹ãªè¿½å¾“
                    damping: 0.1,
                    render: { visible: false }
                }
            });
            Composite.add(engine.world, mouseConstraint);
            render.mouse = mouse;
            mouse.element.removeEventListener('mousewheel', mouse.mousewheel);
            mouse.element.removeEventListener('DOMMouseScroll', mouse.mousewheel);
        }

        function floatAnimation() {
            if (isReleased) return;
            anxietyBodies.forEach(body => {
                const fx = (Math.random() - 0.5) * CONFIG.floatForce;
                const fy = (Math.random() - 0.5) * CONFIG.floatForce;
                Body.applyForce(body, body.position, { x: fx, y: fy });

                const maxV = 1.8;
                if (Math.abs(body.velocity.x) > maxV) Body.setVelocity(body, { x: Math.sign(body.velocity.x) * maxV, y: body.velocity.y });
                if (Math.abs(body.velocity.y) > maxV) Body.setVelocity(body, { x: body.velocity.x, y: Math.sign(body.velocity.y) * maxV });

                Body.applyForce(body, body.position, { x: 0, y: -0.00012 });
            });
        }

        function setupCustomRendering() {
            Events.on(render, 'afterRender', () => {
                const ctx = render.context;
                anxietyBodies.forEach(body => {
                    const pos = body.position;
                    const fontSize = body.circleRadius * 0.42;

                    ctx.save();
                    ctx.translate(pos.x, pos.y);
                    ctx.rotate(body.angle);
                    ctx.font = `400 ${fontSize}px 'Zen Kaku Gothic New', sans-serif`;
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.85)';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(body.label, 0, 0);
                    ctx.restore();
                });
            });
        }

        // ========================================
        // å§”ã­ã‚‹å‡¦ç†
        // ========================================

        function releaseAnxiety() {
            if (isReleased) return;
            isReleased = true;

            yudaneBtn.classList.add('hidden');
            title.classList.add('fade');

            engine.gravity.y = CONFIG.gravityStrength;
            anxietyBodies.forEach(body => {
                Body.applyForce(body, body.position, { x: 0, y: 0.04 });
            });

            setTimeout(() => {
                const rarity = drawRarity();
                const message = rarity.prefix + generateOracle();
                saveRitual(message, rarity);
                currentRitual = { message, rarity };
                showOracle(message, rarity);
            }, 2800);
        }

        function showOracle(message, rarity) {
            app.classList.remove('rarity-N', 'rarity-R', 'rarity-SR', 'rarity-SSR');
            app.classList.add(`rarity-${rarity.name}`);

            // SSRæ¼”å‡º
            if (rarity.name === 'SSR') {
                ssrFlash.classList.add('active');
                ssrExplosion.explode();
                setTimeout(() => ssrFlash.classList.remove('active'), 1500);
            }

            rarityBadge.textContent = rarity.label;

            // ç¥è¨—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆé©åº¦ã«æ”¹è¡Œï¼‰
            const formatted = message.replace(/([ã€ã€‚])/g, '$1<wbr>');
            oracleMessage.innerHTML = formatted;

            oracle.classList.add('visible');
            nextRitual.classList.add('visible');
            startCountdown();
        }

        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            const update = () => { countdown.textContent = formatTime(getTimeUntilMidnight()); };
            update();
            countdownInterval = setInterval(update, 1000);
        }

        // ========================================
        // ã‚·ã‚§ã‚¢
        // ========================================


        function shareToX() {
            if (!currentRitual) return;
            const { message, rarity } = currentRitual;

            // SSRå°‚ç”¨æ¼”å‡º
            if (rarity.name === 'SSR') {
                // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ¼”å‡º
                ssrFlash.classList.add('active');
                ssrExplosion.explode();
                setTimeout(() => ssrFlash.classList.remove('active'), 1500);
            }

            // ãƒ¬ã‚¢ãƒªãƒ†ã‚£åˆ¥ãƒ„ã‚¤ãƒ¼ãƒˆæ–‡
            let tweetText;
            if (rarity.name === 'SSR') {
                tweetText = `ğŸŒŸâœ¨ SSRç¥è¨—ã‚’æˆã‹ã‚Šã¾ã—ãŸ âœ¨ğŸŒŸ\n\nã€Œ${message}ã€\n\né‹å‘½ã®è¨€è‘‰ã‚’å—ã‘å–ã‚Šã¾ã—ãŸã€‚\n\n#YUDANE #SSRç¥è¨—`;
            } else if (rarity.name === 'SR') {
                tweetText = `ğŸ’œ SRç¥è¨—ã‚’å¼•ãã¾ã—ãŸï¼\n\n${message}\n\n#YUDANE`;
            } else if (rarity.name === 'R') {
                tweetText = `ğŸ’ Rç¥è¨—ï¼š\n${message}\n\n#YUDANE`;
            } else {
                tweetText = `ä»Šæ—¥ã®ç¥è¨—ï¼š\n${message}\n\n#YUDANE`;
            }

            const url = 'https://jolly-babka-9847a3.netlify.app/';
            const encoded = encodeURIComponent(tweetText);
            window.open(`https://twitter.com/intent/tweet?text=${encoded}&url=${encodeURIComponent(url)}`, '_blank', 'width=550,height=500');
        }

        // ========================================
        // åˆæœŸåŒ–
        // ========================================

        async function init() {
            // ãƒãƒªãƒ³ã‚¹ãƒãƒ¼åˆæœŸåŒ–
            marineSnow = new MarineSnow(document.getElementById('marine-snow-canvas'));
            ssrExplosion = new SSRParticleExplosion(document.getElementById('ssr-particles-canvas'));

            const saved = loadRitual();

            if (saved) {
                currentRitual = saved;
                title.classList.add('fade');
                yudaneBtn.classList.add('hidden');
                showOracle(saved.message, saved.rarity);
            } else {
                yudaneBtn.textContent = 'èª­ã¿è¾¼ã¿ä¸­...';
                yudaneBtn.disabled = true;

                await generateAnxietyWords();
                initPhysics();
                setupCustomRendering();

                yudaneBtn.textContent = 'å§”ã­ã‚‹';
                yudaneBtn.disabled = false;
            }
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆ
        yudaneBtn.addEventListener('click', releaseAnxiety);
        shareBtn.addEventListener('click', shareToX);
        downloadBtn.addEventListener('click', downloadImage);

        // ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        async function downloadImage() {
            if (!currentRitual) return;
            if (!shareImageGenerator) {
                shareImageGenerator = new ShareImageGenerator();
            }
            await shareImageGenerator.download(currentRitual.message, currentRitual.rarity);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // ========================================
        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        // ========================================

        let deferredPrompt = null;
        const installPrompt = document.getElementById('install-prompt');
        const installBtn = document.getElementById('install-btn');
        const installClose = document.getElementById('install-close');

        // beforeinstallpromptã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // ä¸€åº¦é–‰ã˜ãŸäººã«ã¯1é€±é–“è¡¨ç¤ºã—ãªã„
            const dismissed = localStorage.getItem('pwa-dismissed');
            if (dismissed && Date.now() - parseInt(dismissed) < 7 * 24 * 60 * 60 * 1000) {
                return;
            }

            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰è¡¨ç¤º
            setTimeout(() => {
                installPrompt.classList.remove('hidden');
            }, 5000);
        });

        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (!deferredPrompt) return;

                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;

                if (outcome === 'accepted') {
                    console.log('PWA installed');
                }

                deferredPrompt = null;
                installPrompt.classList.add('hidden');
            });
        }

        // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
        if (installClose) {
            installClose.addEventListener('click', () => {
                installPrompt.classList.add('hidden');
                localStorage.setItem('pwa-dismissed', Date.now().toString());
            });
        }

        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†æ¤œçŸ¥
        window.addEventListener('appinstalled', () => {
            installPrompt.classList.add('hidden');
            deferredPrompt = null;
        });

        // ========================================
        // Service Workerç™»éŒ²
        // ========================================

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>